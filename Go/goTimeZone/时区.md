# 建立表记录

```sql
CREATE TABLE time_test (
	id INT NOT NULL AUTO_INCREMENT,
	updated_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
```

![image-20210119111723394](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119111723394.png)

# 直接从数据库读取

```go
package main

import (
	"database/sql"
	"fmt"
	"time"

	// driver
	_ "github.com/go-sql-driver/mysql"
)

var localMysqlDSN = "root:rootroot@tcp(127.0.0.1:3306)/stats_platform?parseTime=true"
func main() {
	db, _ := sql.Open("mysql", localMysqlDSN)
	defer db.Close()
	var (
		id int64
		updatedAt time.Time
	)
	rows, _ := db.Query("SELECT * FROM time_test")
	for rows.Next(){
		_ = rows.Scan(&id, &updatedAt)
		fmt.Printf("id: %v  updatedAt:%v\n", id, updatedAt)
	}
  timeNow := time.Now()
	fmt.Printf("timeNow: %v\n", timeNow)
}
```

![image-20210119114533857](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119114533857.png)

修改时区为： 纽约-美国东部标准时间

![image-20210118224459128](/Users/knownsec/Library/Application Support/typora-user-images/image-20210118224459128.png)

# 当前时间插入数据库

```go
package main

import (
	"database/sql"
	"fmt"
	"time"

	// driver
	_ "github.com/go-sql-driver/mysql"
)

var localMysqlDSN = "root:rootroot@tcp(127.0.0.1:3306)/stats_platform?parseTime=true"
func main() {
	db, _ := sql.Open("mysql", localMysqlDSN)
	defer db.Close()
	
	timeNow := time.Now()
	fmt.Printf("timeNow: %v\n", timeNow)
	
	db.Exec("INSERT INTO time_test(updated_at) VALUES(?)",timeNow)
	
	var (
		id int64
		updatedAt time.Time
	)
	rows, _ := db.Query("SELECT * FROM time_test")
	for rows.Next(){
		_ = rows.Scan(&id, &updatedAt)
		fmt.Printf("id: %v  updatedAt:%v\n", id, updatedAt)
	}
}
```

![image-20210119123711387](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119123711387.png)

![image-20210119123738864](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119123738864.png)

# 加载时区

```go
package main

import (
	"database/sql"
	"fmt"
	"time"

	// driver
	_ "github.com/go-sql-driver/mysql"
)

var localMysqlDSN = "root:rootroot@tcp(127.0.0.1:3306)/stats_platform?parseTime=true"
func main() {
	db, _ := sql.Open("mysql", localMysqlDSN)
	defer db.Close()
	
	cstSh, _ := time.LoadLocation("Asia/Shanghai")
	usNY, _ := time.LoadLocation("America/New_York")
	timeNowCN := time.Now().In(cstSh)
	timeNowNY := time.Now().In(usNY)
	fmt.Printf("timeNowCN: %v\n", timeNowCN)
	fmt.Printf("timeNowNY: %v\n", timeNowNY)
	
	db.Exec("INSERT INTO time_test(updated_at) VALUES(?),(?);",timeNowCN, timeNowNY)
	
	var (
		id int64
		updatedAt time.Time
	)
	rows, _ := db.Query("SELECT * FROM time_test")
	for rows.Next(){
		_ = rows.Scan(&id, &updatedAt)
		fmt.Printf("id: %v  updatedAt:%v\n", id, updatedAt)
	}
}
```

![image-20210119130458052](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119130458052.png)

# 获取某个时间当日零点

```go
package main

import (
	"database/sql"
	"fmt"
	"time"

	// driver
	_ "github.com/go-sql-driver/mysql"
)

var localMysqlDSN = "root:rootroot@tcp(127.0.0.1:3306)/stats_platform?parseTime=true"
func main() {
	db, _ := sql.Open("mysql", localMysqlDSN)
	defer db.Close()
	
	var (
		id int64
		updatedAt time.Time
	)
	row := db.QueryRow("SELECT * FROM time_test")
	_ = row.Scan(&id, &updatedAt)
	fmt.Printf("id: %v  updatedAt:%v\n", id, updatedAt)

	// updateAt 2021-01-18 22:22:05 UTC
	cstSh, _ := time.LoadLocation("Asia/Shanghai")

	updatedAtStr := updatedAt.Format("2006-01-02") // 2021-01-18
	updatedAtStrSh := updatedAt.In(cstSh).Format("2006-01-02") // 2021-01-19

	updatedDate1, _ := time.Parse("2006-01-02", updatedAtStr) // 2021-01-18 00:00:00 UTC
	updatedDate2, _ := time.Parse("2006-01-02", updatedAtStrSh) // 2021-01-19 00:00:00 UTC

	updatedDateSh1, _ := time.ParseInLocation("2006-01-02", updatedAtStr, cstSh) // 2021-01-18 00:00:00 CST 上海
	updatedDateSh2, _ := time.ParseInLocation("2006-01-02", updatedAtStrSh, cstSh) // 2021-01-19 00:00:00 CST 上海
	
	fmt.Println("updatedDate1:", updatedDate1)
	fmt.Println("updatedDate2:", updatedDate2)
	fmt.Println("updatedDateSh1:", updatedDateSh1)
	fmt.Println("updatedDateSh2:", updatedDateSh2)
}
```

![image-20210119142156607](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119142156607.png)

# 时间比较

```go
package main

import (
	"database/sql"
	"fmt"
	"time"

	// driver
	_ "github.com/go-sql-driver/mysql"
)

var localMysqlDSN = "root:rootroot@tcp(127.0.0.1:3306)/stats_platform?parseTime=true"
func main() {
	db, _ := sql.Open("mysql", localMysqlDSN)
	defer db.Close()
	
	
	var (
		id int64
		updatedAt time.Time
	)
	row := db.QueryRow("SELECT * FROM time_test")
	_ = row.Scan(&id, &updatedAt)
	fmt.Printf("id: %v  updatedAt:%v\n", id, updatedAt)

	cstSh, _ := time.LoadLocation("Asia/Shanghai")
	usNY, _ := time.LoadLocation("America/New_York")
	timeNowCN := time.Now().In(cstSh)
	timeNowNY := time.Now().In(usNY)
	fmt.Printf("timeNowCN: %v\n", timeNowCN)
	fmt.Printf("timeNowNY: %v\n", timeNowNY)

	// 两个时区今日0点
	todayDateStrCN := timeNowCN.Format("2006-01-02")
	todayDateStrNY := timeNowNY.Format("2006-01-02")
	todayZeroTimeCN, _ := time.Parse("2006-01-02", todayDateStrCN) //UTC
	todayZeroTimeNY, _ := time.Parse("2006-01-02", todayDateStrNY) // UTC

	fmt.Println("todayZeroTimeCN:", todayZeroTimeCN)
	fmt.Println("todayZeroTimeNY:", todayZeroTimeNY)
	fmt.Println("updatedAt is before China-today:", updatedAt.Before(todayZeroTimeCN))
	fmt.Println("updatedAt is before NewYork-today:", updatedAt.Before(todayZeroTimeNY))
	fmt.Println("updatedAt is after China-today:", updatedAt.After(todayZeroTimeCN))
	fmt.Println("updatedAt is after NewYork-today:", updatedAt.After(todayZeroTimeNY))
}
```

![image-20210119134201340](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119134201340.png)

```go
package main

import (
	"database/sql"
	"fmt"
	"time"

	// driver
	_ "github.com/go-sql-driver/mysql"
)

var localMysqlDSN = "root:rootroot@tcp(127.0.0.1:3306)/stats_platform?parseTime=true"
func main() {
	db, _ := sql.Open("mysql", localMysqlDSN)
	defer db.Close()
	
	
	var (
		id int64
		updatedAt time.Time
	)
	row := db.QueryRow("SELECT * FROM time_test")
	_ = row.Scan(&id, &updatedAt)
	fmt.Printf("id: %v  updatedAt:%v\n", id, updatedAt)

	cstSh, _ := time.LoadLocation("Asia/Shanghai")
	usNY, _ := time.LoadLocation("America/New_York")
	timeNowCN := time.Now().In(cstSh)
	timeNowNY := time.Now().In(usNY)
	fmt.Printf("timeNowCN: %v\n", timeNowCN)
	fmt.Printf("timeNowNY: %v\n", timeNowNY)

	// 两个时区今日0点
	todayDateStrCN := timeNowCN.Format("2006-01-02")
	todayDateStrNY := timeNowNY.Format("2006-01-02")
	todayZeroTimeCN, _ := time.ParseInLocation("2006-01-02", todayDateStrCN, cstSh) //上海时区
	todayZeroTimeNY, _ := time.ParseInLocation("2006-01-02", todayDateStrNY, usNY) // 纽约时区

	fmt.Println("todayZeroTimeCN:", todayZeroTimeCN)
	fmt.Println("todayZeroTimeNY:", todayZeroTimeNY)
	fmt.Println("updatedAt is before China-today:", updatedAt.Before(todayZeroTimeCN))
	fmt.Println("updatedAt is before NewYork-today:", updatedAt.Before(todayZeroTimeNY))
	fmt.Println("updatedAt is after China-today:", updatedAt.After(todayZeroTimeCN))
	fmt.Println("updatedAt is after NewYork-today:", updatedAt.After(todayZeroTimeNY))
}
```

![image-20210119134757787](/Users/knownsec/Library/Application Support/typora-user-images/image-20210119134757787.png)

# 时间比较举例—判断两个日期是否是同一天

假设系统时间已经设置为`Asia/Shanghai`时区

```go
// IsToday 判断统计日期是否是今天
// statTIme 是从数据库获取然后作为参数传递
var cstSh, _ = time.LoadLocation("Asia/Shanghai") //加载时区

func IsToday(statTime time.Time) bool {
	statTimeStr := statTime.Format("2006-01-02")
	todayTimeStr := time.Now().Format("2006-01-02")
	statDate, err := time.ParseInLocation("2006-01-02", statTimeStr, cstSh)
	if err != nil {
		log.Fatalln(err)
	}
	todayDate, err := time.ParseInLocation("2006-01-02", todayTimeStr, cstSh)
	if err != nil {
		log.Fatalln(err)
	}
	if statDate.Equal(todayDate) {
		return true
	}
	return false
}
```

你觉得对吗？